---
title: "Use of Rmarkdown: taking GFM package as an example"
author: "Wei Liu"
date: '2020-11-23'
output:
  html_document:
    fig_caption: yes
    highlight: pygments
    theme: cerulean
    toc: yes
  word_document:
    toc: yes
  pdf_document: 
    highlight: kate
    number_sections: yes
    toc: yes
    toc_depth: 5
---
# Introduction of Rmarkdown
In this section, we briefly introduce some features of Rmarkdown.The Laguage of Rmarkdown is similar to that of Markdown, which is very easy to learn and write it.

## Creating Rmarkdown file in Rstudio
Firstly, we create a new file in Rstudio, then choose the format of this file as 'Rmd'(extension name). If we uncarefully save it as format 'md', then we can not run R code in each small chunk. Second, we need to set the header, including 'title', 'author', 'date', 'output', where title is the title of this document,  'author' and 'date' are the author and created date of this document, 'output' specifies the information about the output file. As for output file, we can generate three types of files, including 'html', 'word' and 'pdf', whose setting can be done in the setting whidow of 'Knit'. The following is an example of header of this file.
```{Markdown}
title: "Use of Rmarkdown: taking GFM package as an example"
author: "Wei Liu"
date: '2020-11-23'
output:
  pdf_document: 
    highlight: kate
    number_sections: yes
    toc: yes
  word_document:
    toc: yes
  html_document:
    fig_caption: yes
    highlight: pygments
    theme: cerulean
    toc: yes
```
Aftering finishing the setting, we can arbitrarily write our contents of document. If any problem about the statements, we can turn to Baidu, Biying or Google!

# R package GFM
In this section, we provide an inroduction to the **[GFM](https://github.com/feiyoung/RGFM)** package, which is available at \url{https://github.com/feiyoung/RGFM}. R package GFM implements GFM, the generalized factor models for utra-high-dimensional mixed correlated data. It is more powerful than linear factor analysis, since it can handle mixed data, achieve nonlinear feature extraction and have theoretical guarantee.  We can install the package from github by using following codes.
```{r, eval=F, echo=TRUE}
library(devtools)
install_github("feiyoung/GFM")
```
Load the package using the following command:
```{r}
library(GFM)
```
## GFM feature extraction using simulated data
In the following, we give some examples with different variable types.
###  Homogeneous  continuous variables
We first generate data with homogeneous normal variables  from the following model
$$x_{ij}= \mu_j + h_i b_j^T + u_{ij}, $$
where $u_{ij} \sim N(0, \sigma^2)$,  which can be generated by function *gendata*:
  ```{r}
n <- 100
p <- 100
q <- 2; rho <- 3
dat <- gendata(q = q, n=n, p=p, rho=rho)
str(dat)
```
In the above commands, *n* is the sample size, *p* is the variable dimension, *q* is the number of factors, $\rho$ controls the signal strength. We can refer to the help file using 
```{r, eval=F}
?gendata
```
for more details.

Then we fit the **GFM** model by following commands:
  ```{r}
group <- rep(1,ncol(dat$X))
type <- 'gaussian'
# specify q=2
gfm1 <- gfm(dat$X, group, type, q=2, output = F)
str(gfm1)
# select q automatically
gfm2 <- gfm(dat$X, group, type, q=NULL, q_set = 1:6, output = F)
str(gfm2)
# measure the performance of GFM estimators
measurefun(gfm2$hH, dat$H0, type='ccor')
measurefun(gfm2$hB, dat$B0, type='ccor')
```
In the above commands, we require to specify the types of each variables by parameters *group* and *type*. At the same time, we can speficy the number of factors to be extracted or let it be automatically selected by PC(IC) criteria.
###  Heterogeous  continuous variables
In this exmaple, we generate data with heterogeous normal variables  from the following model
$$x_{ij}= \mu_j + h_i b_j^T + u_{ij},$$
  ,where $u_{ij} \sim N(0, \sigma_j^2)$,  which can be generated by function *gendata*:
  ```{r}
n <- 100
p <- 100
q <- 2; rho <- 4
type <- 'heternorm'
dat <- gendata(seed=1, n=n, p=p, type= type, q=q, rho=rho)
str(dat)
```
```{r}
group <- rep(1,ncol(dat$X))
type <- 'gaussian'
gfm3 <- gfm(dat$X, group, type, q=NULL, q_set = 1:4, output = F)
plot(gfm3$history$dc, type='o')
```
We compare the performance with the linear factor model by using functions *measurefun* and *Factorm*, where the measure of cononical correlation is used. The larger its value, the better.
```{r}
measurefun(gfm3$hH, dat$H0, type='ccor')
measurefun(gfm3$hB, dat$B0, type='ccor')
Fac <- Factorm(dat$X)
measurefun(Fac$hH, dat$H0, type='ccor')
measurefun(Fac$hB, dat$B0, type='ccor')
```
The above results show that GFM can produce better estimators by using the information of heterogeous variances.
